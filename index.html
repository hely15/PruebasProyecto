<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Foro - Registro con Google</title>
    
    <!-- Estilos CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: #4285F4;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .nav-links a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .auth-section {
            margin-left: auto;
        }
        
        .btn-login {
            background-color: white;
            color: #4285F4;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
        }
        
        .btn-login:hover {
            background-color: #f0f0f0;
        }
        
        .btn-login img {
            width: 18px;
            margin-right: 10px;
        }
        
        .user-info {
            display: none;
            align-items: center;
            color: white;
        }
        
        .user-info img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        
        .btn-logout {
            background-color: #ff4336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
        }
        
        main {
            flex: 1;
            padding: 20px;
        }
        
        .welcome-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
        }
        
        .welcome-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .welcome-text {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .welcome-box .btn-login {
            margin: 0 auto;
            display: inline-flex;
        }
        
        .signed-in-content {
            display: none;
            text-align: center;
        }
        
        .signed-in-content h2 {
            color: #4285F4;
            margin-bottom: 15px;
        }
        
        .user-photo-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: block;
            border: 3px solid #4285F4;
            object-fit: cover;
        }
        
        /* Estilos para el perfil de usuario */
        .profile-section {
            display: none;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
            border: 3px solid #4285F4;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 24px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .profile-email {
            color: #666;
            margin-bottom: 10px;
        }
        
        .profile-details {
            margin-bottom: 30px;
        }
        
        .detail-row {
            margin-bottom: 15px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }
        
        .detail-value {
            padding: 10px;
            border-radius: 5px;
            background-color: #f5f5f5;
            width: 100%;
            border: 1px solid #ddd;
        }
        
        .profile-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }
        
        .form-input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 100%;
        }
        
        .form-textarea {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 100%;
            min-height: 100px;
            resize: vertical;
        }
        
        .btn-save {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-save:hover {
            background-color: #45a049;
        }
        
        /* Estilos para el foro */
        .forum-section {
            display: none;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        .forum-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .create-post-box {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .create-post-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .post-list {
            margin-top: 30px;
        }
        
        .post-item {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #4285F4;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .post-author-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }
        
        .post-author-name {
            font-weight: bold;
            color: #333;
        }
        
        .post-date {
            color: #888;
            font-size: 14px;
            margin-left: auto;
        }
        
        .post-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .post-content {
            color: #555;
            line-height: 1.6;
        }
        
        .post-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            color: #888;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: none;
            margin: 0 5px;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background-color: #4285F4;
            color: white;
        }
        
        .tab:hover {
            background-color: #e0e0e0;
        }
        
        .tab.active:hover {
            background-color: #3b77db;
        }
        
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loader::after {
            content: "Cargando...";
            color: #666;
        }
        
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .success-message {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Mi Foro</div>
                <div class="nav-links">
                    <a href="#" id="navHome" class="active">Inicio</a>
                    <a href="#" id="navForum">Foro</a>
                    <a href="#" id="navProfile">Mi Perfil</a>
                </div>
                <div class="auth-section">
                    <button id="btnHeaderLogin" class="btn-login">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                        Iniciar sesión
                    </button>
                    <div id="userInfo" class="user-info">
                        <img id="userPhoto" src="https://via.placeholder.com/32" alt="Foto de perfil">
                        <span id="userName">Usuario</span>
                        <button id="btnLogout" class="btn-logout">Salir</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Sección de bienvenida -->
            <div id="welcomeBox" class="welcome-box">
                <h1 class="welcome-title">Bienvenido a Mi Foro</h1>
                <p class="welcome-text">
                    Un espacio para compartir ideas y opiniones con la comunidad.
                    Regístrate para acceder a todas las funciones del foro.
                </p>
                <button id="btnMainLogin" class="btn-login">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                    Registrarse con Google
                </button>
                
                <div id="signedInContent" class="signed-in-content">
                    <img id="userPhotoLarge" class="user-photo-large" src="https://via.placeholder.com/100" alt="Foto de perfil">
                    <h2>¡Registro exitoso!</h2>
                    <p>
                        Bienvenido <strong id="userNameBig">Usuario</strong>.<br>
                        Te has registrado correctamente en nuestro foro.
                    </p>
                </div>
            </div>
            
            <!-- Sección de perfil de usuario -->
            <div id="profileSection" class="profile-section">
                <h2 class="welcome-title">Mi Perfil</h2>
                
                <div class="profile-header">
                    <img id="profilePhoto" class="profile-photo" src="https://via.placeholder.com/120" alt="Foto de perfil">
                    <div class="profile-info">
                        <h3 id="profileName" class="profile-name">Nombre de Usuario</h3>
                        <p id="profileEmail" class="profile-email">usuario@ejemplo.com</p>
                    </div>
                </div>
                
                <div class="profile-details">
                    <div class="detail-row">
                        <span class="detail-label">Biografía</span>
                        <p id="profileBio" class="detail-value">Añade una biografía para que otros usuarios te conozcan mejor.</p>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Ubicación</span>
                        <p id="profileLocation" class="detail-value">Añade tu ubicación</p>
                    </div>
                    
                    <div class="detail-row">
                        <span class="detail-label">Intereses</span>
                        <p id="profileInterests" class="detail-value">Añade tus intereses</p>
                    </div>
                </div>
                
                <div class="error-message" id="profileError"></div>
                <div class="success-message" id="profileSuccess"></div>
                
                <div class="profile-form">
                    <h3 class="welcome-title">Editar Perfil</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="inputBio">Biografía</label>
                        <textarea id="inputBio" class="form-textarea" placeholder="Escribe una breve biografía sobre ti"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="inputLocation">Ubicación</label>
                        <input type="text" id="inputLocation" class="form-input" placeholder="Tu ciudad o país">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="inputInterests">Intereses (separados por coma)</label>
                        <input type="text" id="inputInterests" class="form-input" placeholder="programación, deportes, música, etc.">
                    </div>
                    
                    <button id="btnSaveProfile" class="btn-save">Guardar Cambios</button>
                </div>
                
                <div class="loader" id="profileLoader"></div>
            </div>
            
            <!-- Sección del foro -->
            <div id="forumSection" class="forum-section">
                <h2 class="forum-title">Foro de la Comunidad</h2>
                
                <div class="create-post-box">
                    <h3 class="create-post-title">Crear nueva publicación</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="postTitle">Título</label>
                        <input type="text" id="postTitle" class="form-input" placeholder="Título de tu publicación">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="postContent">Contenido</label>
                        <textarea id="postContent" class="form-textarea" placeholder="Escribe el contenido de tu publicación"></textarea>
                    </div>
                    
                    <div class="error-message" id="postError"></div>
                    <div class="success-message" id="postSuccess"></div>
                    
                    <button id="btnCreatePost" class="btn-save">Publicar</button>
                </div>
                
                <div class="tabs">
                    <button class="tab active" id="tabAllPosts">Todas las publicaciones</button>
                    <button class="tab" id="tabMyPosts">Mis publicaciones</button>
                </div>
                
                <div class="loader" id="postsLoader"></div>
                
                <div id="postsList" class="post-list">
                    <!-- Las publicaciones se agregarán dinámicamente aquí -->
                </div>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            // IMPORTANTE: Reemplazar con tus credenciales de Firebase
            apiKey: "AIzaSyCL2CctB5ULQg2tkWKKTX20-Aot0aGsVYw",
            authDomain: "registrocon-97cb2.firebaseapp.com",
            projectId: "registrocon-97cb2",
            storageBucket: "registrocon-97cb2.firebasestorage.app",
            messagingSenderId: "373644979789",
            appId: "1:373644979789:web:5b08ef46eb8852c59fb604",
            measurementId: "G-X5Q3RL90PV"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Referencias a elementos DOM - Autenticación
        const btnHeaderLogin = document.getElementById('btnHeaderLogin');
        const btnMainLogin = document.getElementById('btnMainLogin');
        const btnLogout = document.getElementById('btnLogout');
        const userInfo = document.getElementById('userInfo');
        const userName = document.getElementById('userName');
        const userNameBig = document.getElementById('userNameBig');
        const userPhoto = document.getElementById('userPhoto');
        const userPhotoLarge = document.getElementById('userPhotoLarge');
        const welcomeBox = document.getElementById('welcomeBox');
        const signedInContent = document.getElementById('signedInContent');
        
        // Referencias a elementos DOM - Navegación
        const navHome = document.getElementById('navHome');
        const navForum = document.getElementById('navForum');
        const navProfile = document.getElementById('navProfile');
        const profileSection = document.getElementById('profileSection');
        const forumSection = document.getElementById('forumSection');
        
        // Referencias a elementos DOM - Perfil
        const profilePhoto = document.getElementById('profilePhoto');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profileBio = document.getElementById('profileBio');
        const profileLocation = document.getElementById('profileLocation');
        const profileInterests = document.getElementById('profileInterests');
        const inputBio = document.getElementById('inputBio');
        const inputLocation = document.getElementById('inputLocation');
        const inputInterests = document.getElementById('inputInterests');
        const btnSaveProfile = document.getElementById('btnSaveProfile');
        const profileLoader = document.getElementById('profileLoader');
        const profileError = document.getElementById('profileError');
        const profileSuccess = document.getElementById('profileSuccess');
        
        // Referencias a elementos DOM - Foro
        const postTitle = document.getElementById('postTitle');
        const postContent = document.getElementById('postContent');
        const btnCreatePost = document.getElementById('btnCreatePost');
        const postsList = document.getElementById('postsList');
        const postsLoader = document.getElementById('postsLoader');
        const tabAllPosts = document.getElementById('tabAllPosts');
        const tabMyPosts = document.getElementById('tabMyPosts');
        const postError = document.getElementById('postError');
        const postSuccess = document.getElementById('postSuccess');
        
        // Variables globales
        let currentUser = null;
        let currentTab = 'all'; // 'all' o 'my'
        
        // Evento de autenticación
        auth.onAuthStateChanged(user => {
            if (user) {
                // Usuario ha iniciado sesión
                currentUser = user;
                showUserInfo(user);
                btnHeaderLogin.style.display = 'none';
                userInfo.style.display = 'flex';
                btnMainLogin.style.display = 'none';
                signedInContent.style.display = 'block';
                
                // Verificar si el usuario ya existe en la base de datos
                checkUserInFirestore(user);
                
                // Mostrar elementos de navegación
                navForum.style.display = 'block';
                navProfile.style.display = 'block';
                
                // Cargar datos del perfil
                loadUserProfile(user.uid);
                
                // Cargar publicaciones
                loadPosts(currentTab);
            } else {
                // Usuario ha cerrado sesión
                currentUser = null;
                btnHeaderLogin.style.display = 'flex';
                userInfo.style.display = 'none';
                btnMainLogin.style.display = 'inline-flex';
                signedInContent.style.display = 'none';
                
                // Ocultar secciones que requieren inicio de sesión
                showSection('welcome');
                
                // Ocultar elementos de navegación
                navForum.style.display = 'block';
                navProfile.style.display = 'none';
            }
        });

        // Función para iniciar sesión con Google
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .catch(error => {
                    console.error("Error en autenticación:", error);
                    alert("Error al iniciar sesión: " + error.message);
                });
        }

        // Iniciar sesión con Google (botón del header)
        btnHeaderLogin.addEventListener('click', loginWithGoogle);
        
        // Iniciar sesión con Google (botón principal)
        btnMainLogin.addEventListener('click', loginWithGoogle);

        // Cerrar sesión
        btnLogout.addEventListener('click', () => {
            auth.signOut().catch(error => {
                console.error("Error al cerrar sesión:", error);
            });
        });

        // Mostrar información del usuario
        function showUserInfo(user) {
            userName.textContent = user.displayName;
            userNameBig.textContent = user.displayName;
            
            if (user.photoURL) {
                userPhoto.src = user.photoURL;
                userPhotoLarge.src = user.photoURL;
            }
        }
        
        // Verificar si el usuario existe en Firestore
        function checkUserInFirestore(user) {
            db.collection('users').doc(user.uid).get()
                .then(doc => {
                    if (!doc.exists) {
                        // Si el usuario no existe, lo creamos
                        createUserInFirestore(user);
                    }
                })
                .catch(error => {
                    console.error("Error al verificar usuario:", error);
                });
        }
        
        // Crear usuario en Firestore
        function createUserInFirestore(user) {
            db.collection('users').doc(user.uid).set({
                uid: user.uid,
                displayName: user.displayName || '',
                email: user.email || '',
                photoURL: user.photoURL || '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                bio: '',
                location: '',
                interests: []
            })
            .then(() => {
                console.log("Usuario creado en Firestore");
            })
            .catch(error => {
                console.error("Error al crear usuario:", error);
            });
        }
        
        // Cargar perfil del usuario
        function loadUserProfile(uid) {
            profileLoader.style.display = 'block';
            
            db.collection('users').doc(uid).get()
                .then(doc => {
                    profileLoader.style.display = 'none';
                    
                    if (doc.exists) {
                        const userData = doc.data();
                        
                        // Mostrar datos en el perfil
                        profilePhoto.src = userData.photoURL || 'https://via.placeholder.com/120';
                        profileName.textContent = userData.displayName || 'Usuario';
                        profileEmail.textContent = userData.email || '';
                        profileBio.textContent = userData.bio || 'Añade una biografía para que otros usuarios te conozcan mejor.';
                        profileLocation.textContent = userData.location || 'Añade tu ubicación';
                        profileInterests.textContent = userData.interests && userData.interests.length > 0 
                            ? userData.interests.join(', ') 
                            : 'Añade tus intereses';
                        
                        // Rellenar formulario de edición
                        inputBio.value = userData.bio || '';
                        inputLocation.value = userData.location || '';
                        inputInterests.value = userData.interests && userData.interests.length > 0 
                            ? userData.interests.join(', ') 
                            : '';
                    }
                })
                .catch(error => {
                    profileLoader.style.display = 'none';
                    console.error("Error al cargar perfil:", error);
                    showErrorMessage(profileError, "Error al cargar el perfil. Inténtalo de nuevo más tarde.");
                });
        }
        
        // Guardar cambios del perfil
        btnSaveProfile.addEventListener('click', () => {
            if (!currentUser) {
                showErrorMessage(profileError, "Debes iniciar sesión para guardar cambios.");
                return;
            }
            
            profileLoader.style.display = 'block';
            hideMessages();
            
            // Procesar intereses como array
            const interestsArray = inputInterests.value.split(',')
                .map(interest => interest.trim())
                .filter(interest => interest !== '');
            
            const userData = {
                bio: inputBio.value.trim(),
                location: inputLocation.value.trim(),
                interests: interestsArray,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('users').doc(currentUser.uid).update(userData)
                .then(() => {
                    profileLoader.style.display = 'none';
                    showSuccessMessage(profileSuccess, "Perfil actualizado correctamente.");
                    
                    // Actualizar la visualización del perfil
                    profileBio.textContent = userData.bio || 'Añade una biografía para que otros usuarios te conozcan mejor.';
                    profileLocation.textContent = userData.location || 'Añade tu ubicación';
                    profileInterests.textContent = userData.interests.length > 0 
                        ? userData.interests.join(', ') 
                        : 'Añade tus intereses';
                })
                .catch(error => {
                    profileLoader.style.display = 'none';
                    console.error("Error al actualizar perfil:", error);
                    showErrorMessage(profileError, "Error al actualizar el perfil. Inténtalo de nuevo más tarde.");
                });
        });
        
        // Crear publicación
        btnCreatePost.addEventListener('click', () => {
            if (!currentUser) {
                showErrorMessage(postError, "Debes iniciar sesión para crear una publicación.");
                return;
            }
            
            const title = postTitle.value.trim();
            const content = postContent.value.trim();
            
            if (!title) {
                showErrorMessage(postError, "El título es obligatorio.");
                return;
            }
            
            if (!content) {
                showErrorMessage(postError, "El contenido es obligatorio.");
                return;
            }
            
            postsLoader.style.display = 'block';
            hideMessages();
            
            // Obtener datos del usuario para la publicación
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    const userData = doc.exists ? doc.data() : {};
                    
                    const newPost = {
                        title: title,
                        content: content,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        authorId: currentUser.uid,
                        authorName: userData.displayName || currentUser.displayName || 'Usuario anónimo',
                        authorPhotoURL: userData.photoURL || currentUser.photoURL
        // ...continuación dentro de <script> después de crear newPost.authorPhotoURL...
        };
                    
                    // Guardar la nueva publicación
                    db.collection('posts').add(newPost)
                        .then(() => {
                            postsLoader.style.display = 'none';
                            showSuccessMessage(postSuccess, "Publicación creada correctamente.");
                            postTitle.value = "";
                            postContent.value = "";
                            loadPosts(currentTab); // recarga feed
                        })
                        .catch(error => {
                            postsLoader.style.display = 'none';
                            console.error("Error al crear publicación:", error);
                            showErrorMessage(postError, "Error al crear la publicación. Inténtalo de nuevo.");
                        });
                });
        });

        // Función para cargar posts
        function loadPosts(tab) {
            postsList.innerHTML = "";
            postsLoader.style.display = 'block';
            let query = db.collection('posts').orderBy('createdAt', 'desc');
            if (tab === 'my' && currentUser) {
                query = query.where('authorId', '==', currentUser.uid);
            }
            query.get()
                .then(snapshot => {
                    postsLoader.style.display = 'none';
                    if (snapshot.empty) {
                        postsList.innerHTML = `<p style="text-align:center; color:#666">No hay publicaciones para mostrar.</p>`;
                        return;
                    }
                    snapshot.forEach(doc => {
                        const post = doc.data();
                        const date = post.createdAt && post.createdAt.toDate
                            ? post.createdAt.toDate().toLocaleString()
                            : '';
                        const item = document.createElement('div');
                        item.className = 'post-item';
                        item.innerHTML = `
                            <div class="post-header">
                                <img class="post-author-photo" src="${post.authorPhotoURL || 'https://via.placeholder.com/40'}" alt="Foto">
                                <span class="post-author-name">${post.authorName}</span>
                                <span class="post-date">${date}</span>
                            </div>
                            <h3 class="post-title">${post.title}</h3>
                            <p class="post-content">${post.content}</p>
                        `;
                        postsList.appendChild(item);
                    });
                })
                .catch(error => {
                    postsLoader.style.display = 'none';
                    console.error("Error al cargar publicaciones:", error);
                    postsList.innerHTML = `<p style="text-align:center; color:#c62828">Error al cargar publicaciones.</p>`;
                });
        }

        // Mostrar/ocultar secciones
        function showSection(name) {
            welcomeBox.style.display   = name === 'welcome' ? 'block' : 'none';
            forumSection.style.display = name === 'forum'   ? 'block' : 'none';
            profileSection.style.display = name === 'profile' ? 'block' : 'none';
            // ajustar pestañas activas
            navHome.classList.toggle('active', name === 'welcome');
            navForum.classList.toggle('active', name === 'forum');
            navProfile.classList.toggle('active', name === 'profile');
        }

        // Manejo de pestañas de navegación
        navHome.addEventListener('click', ()    => showSection('welcome'));
        navForum.addEventListener('click', ()   => showSection('forum'));
        navProfile.addEventListener('click', () => showSection('profile'));

        // Pestañas de filtro de posts
        tabAllPosts.addEventListener('click', () => {
            currentTab = 'all';
            tabAllPosts.classList.add('active');
            tabMyPosts.classList.remove('active');
            loadPosts('all');
        });
        tabMyPosts.addEventListener('click', () => {
            currentTab = 'my';
            tabMyPosts.classList.add('active');
            tabAllPosts.classList.remove('active');
            loadPosts('my');
        });

        // Funciones de mensajes
        function hideMessages() {
            [postError, postSuccess, profileError, profileSuccess].forEach(el => el.style.display = 'none');
        }
        function showErrorMessage(el, msg) {
            el.textContent = msg;
            el.style.display = 'block';
        }
        function showSuccessMessage(el, msg) {
            el.textContent = msg;
            el.style.display = 'block';
        }

        // Al cargar la página, mostrar bienvenida
        document.addEventListener('DOMContentLoaded', () => {
            showSection('welcome');
        });
    </script>
</body>
</html>
